{"version":3,"sources":["index.js"],"names":["SIZE","CENTER","mouse","x","y","COLORS","canvas","document","getElementById","context","getContext","width","height","imageData","getImageData","buffer","ArrayBuffer","data","length","bufferViewInt8","Uint8ClampedArray","bufferViewInt32","Uint32Array","levelBuffer","levelBufferViewInt8","isInsideCircle","x1","y1","x2","y2","r","Math","sqrt","rain","w","offsetWidth","style","index","isRain","isStreet","round","isUmbrella","random","moveDroplet","set","putImageData","src","nextLevel","rand","horizontalMovement","floor","verticalMovement","nextColor","render","requestAnimationFrame","Noise","track","audioContext","window","AudioContext","webkitAudioContext","createNoise","lastOut","bufferSize","sampleRate","noiseBuffer","createBuffer","output","getChannelData","i","white","audioSource","stopNoise","stop","buildTrack","createBufferSource","gainNode","createGain","connect","destination","setGain","volume","gain","setValueAtTime","currentTime","linearRampToValueAtTime","playNoise","loop","start","play","handleMousemove","event","target","value","handleRainChange","handleSoundChange","wind","addEventListener","rainRangeElement","soundRangeElement"],"mappings":"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","file":"bitfire.e31bb0bc.js","sourceRoot":"..","sourcesContent":["const SIZE = 270;\nconst CENTER = SIZE / 2;\n\nlet mouse = {\n    x: 0.5,\n    y: 0.4\n};\n\n// A gray-scale height-map.\nconst COLORS = [\n    [255, 255, 255],\n    [240, 240, 240],\n    [217, 217, 217],\n    [189, 189, 189],\n    [150, 150, 150],\n    [115, 115, 115],\n    [82, 82, 82],\n    [37, 37, 37],\n    [0, 0, 0]\n];\n\n\n// Setup the canvas.\nconst canvas = document.getElementById('canvas');\nconst context = canvas.getContext('2d');\n\ncanvas.width = SIZE;\ncanvas.height = SIZE;\n\nconst imageData = context.getImageData(0, 0, SIZE, SIZE);\n\n// One buffer to hold the color data for each pixel.\nconst buffer = new ArrayBuffer(imageData.data.length);\nconst bufferViewInt8 = new Uint8ClampedArray(buffer);\nconst bufferViewInt32 = new Uint32Array(buffer);\n\n// One buffer to hold the height map level for each pixel.\nconst levelBuffer = new ArrayBuffer(imageData.data.length);\nconst levelBufferViewInt8 = new Uint8ClampedArray(levelBuffer);\n\n// Check if a coordinate is inside a circle with center x1, y1 and radius r.\nfunction isInsideCircle(x1, y1, x2, y2, r) {\n    return Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2)) < r\n}\n\nfunction rain() {\n\n    const w = canvas.offsetWidth;\n    canvas.style.height = w;\n\n    for (let y = 0; y < SIZE; y += 1) {\n        for (let x = 0; x < SIZE; x += 1) {\n\n            const index = (y) * SIZE + x;\n\n            // Generate rain in the top of the image.\n            const isRain = y < 2;\n\n            // Generate a flooded street in the bottom of the image.\n            const isStreet = y > Math.round(CENTER * 1.53) && y < Math.round(CENTER * 1.57);\n\n            // Mask out the silhouette of an umbrella in the middle of the image.\n            const isUmbrella = Math.random() > 0.8\n                && isInsideCircle(CENTER, CENTER, x, y, 32)\n                && !isInsideCircle(CENTER, CENTER - 10, x - 1, y, 40);\n\n            if (isRain || isStreet || isUmbrella) {\n                levelBufferViewInt8[index] = 0;\n            }\n\n            // Bring it to life.\n            moveDroplet(index);\n        }\n    }\n\n    // Update the canvas with the new pixel values.\n    imageData.data.set(bufferViewInt8);\n    context.putImageData(imageData, 0, 0);\n}\n\nfunction moveDroplet(src) {\n\n    const nextLevel = levelBufferViewInt8[src] + Math.round(Math.random() * 1.3);\n\n    // Generate a 0, 1 or 2.\n    const rand = Math.round(Math.random() * 2.0);\n\n    // Add horizontal movement to create a wind effect.\n    const horizontalMovement = Math.random() > 0.8\n        ? src - rand + Math.floor((mouse.x * 8 - 3))\n        : src;\n\n    // Every 1 in 5 the rain will move up-wards and create the\n    // street splash effect.\n    const verticalMovement = Math.floor(Math.random() * (4 + Math.floor((mouse.y * 4)))) * (Math.random() > 0.2\n        ? 1\n        : -1);\n\n    levelBufferViewInt8[horizontalMovement + (SIZE * verticalMovement)] = nextLevel - (rand & 1);\n\n    const nextColor = COLORS[nextLevel] || 11;\n\n    // Set the new pixel value.\n    bufferViewInt32[src - SIZE] =\n        (255 << 24) |           // Alpha\n        (nextColor[2] << 16) |  // Blue\n        (nextColor[1] << 8) |   // Green\n        nextColor[0];           // Red\n}\n\nfunction render() {\n    rain();\n\n    // Go again!\n    // setTimeout(function () {\n    requestAnimationFrame(() => render());\n    // }, 1000);\n}\n\n// Go!\nrender();\n\n\nvar Noise = (function () {\n\n    const track = {};\n    const audioContext = new (window.AudioContext || window.webkitAudioContext);\n\n    function createNoise(track) {\n        var lastOut = 0.0;\n        const bufferSize = 2 * audioContext.sampleRate;\n        const noiseBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);\n        const output = noiseBuffer.getChannelData(0);\n\n        for (let i = 0; i < bufferSize; i++) {\n            var white = Math.random() * 2 - 1;\n            output[i] = (lastOut + (0.02 * white)) / 1.02;\n            lastOut = output[i];\n            output[i] *= 3.5;\n        }\n\n        track.audioSource.buffer = noiseBuffer;\n    }\n\n    function stopNoise() {\n        if (track.audioSource) {\n            track.audioSource.stop();\n        }\n    }\n\n\n    function buildTrack(track) {\n        track.audioSource = audioContext.createBufferSource();\n        track.gainNode = audioContext.createGain();\n        track.audioSource.connect(track.gainNode);\n        track.gainNode.connect(audioContext.destination);\n    }\n\n    function setGain(track) {\n        track.volume = 0.1;\n        track.gainNode.gain.setValueAtTime(0, audioContext.currentTime);\n        track.gainNode.gain.linearRampToValueAtTime(track.volume / 4, audioContext.currentTime / 2);\n        track.gainNode.gain.linearRampToValueAtTime(track.volume, audioContext.currentTime);\n\n    }\n\n    function playNoise() {\n        stopNoise(track);\n        buildTrack(track);\n        createNoise(track);\n        setGain(track);\n        track.audioSource.loop = true;\n        track.audioSource.start();\n    }\n\n    // Expose functions:\n    return {\n        play: playNoise,\n        stop: stopNoise\n    }\n\n}());\n\n\nlet handleMousemove = (event) => {\n    const {target} = event;\n    mouse.x = target.value / 100;\n};\n\nconst handleRainChange = (event) => {\n    const {target} = event;\n    mouse.y = target.value / 100;\n};\n\nconst handleSoundChange = (event) => {\n    const {target} = event;\n    if (target.value === \"1\") {\n        Noise.play();\n    } else {\n        Noise.stop();\n    }\n};\n\n\nconst wind = document.getElementById('wind');\nwind.addEventListener('input', handleMousemove);\n\nconst rainRangeElement = document.getElementById('rain');\nrainRangeElement.addEventListener('input', handleRainChange);\n\n\nconst soundRangeElement = document.getElementById('sound');\nsoundRangeElement.addEventListener('input', handleSoundChange);\n\n// canvas.addEventListener('click', () => Noise.play());\n"]}